// Create Event for obj_controller

// Initialize global variables
if (!variable_global_exists("current_skin")) {
    global.current_skin = "player"; // Default starting skin
}
if (!variable_global_exists("player_instance")) {
    global.player_instance = noone; // Initialize as noone to avoid access issues
}
if (!variable_global_exists("camera")) {
    global.camera = camera_create(); // Create the camera as a global variable
}

// Create player instance if it doesn't exist
if (!instance_exists(global.player_instance)) {
    if (global.current_skin == "player") {
        global.player_instance = instance_create_layer(100, 100, "Instances", obj_player);
    } else if (global.current_skin == "icetruck") {
        global.player_instance = instance_create_layer(100, 100, "Instances", obj_player_icetruck);
    }
}

global.skins = [
    { name: "Player", object: obj_player },
    { name: "Ice Truck", object: obj_player_icetruck }
];

// Create Event for obj_controller
if (!instance_exists(obj_player) && !instance_exists(obj_player_icetruck)) {
    global.current_skin = "player"; // Starting skin
    global.player_instance = instance_create_layer(x, y, "Instances", obj_player); // Create player instance
} else {
    // Find the existing player or ice truck instance
    if (instance_exists(obj_player)) {
        global.current_skin = "player";
        global.player_instance = instance_find(obj_player, 0);
    } else if (instance_exists(obj_player_icetruck)) {
        global.current_skin = "icetruck";
        global.player_instance = instance_find(obj_player_icetruck, 0);
    }
}

// Attach camera to view
view_set_camera(0, global.camera);
camera_set_view_size(global.camera, view_wview[0], view_hview[0]);
camera_set_view_pos(global.camera, 0, 0);

// Debugging message
show_debug_message("obj_controller: Initialization complete. Player instance ID: " + string(global.player_instance));

