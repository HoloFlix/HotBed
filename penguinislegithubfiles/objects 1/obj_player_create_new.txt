// Create Event for obj_player

// Core variables
xspd = 0;
yspd = 0;
move_spd = 2;

// Sliding variables
sliding = false;
slide_dir_x = 0;
slide_dir_y = 0;
slide_speed = 0;

// Driving variables
driving = false;
ice_truck_sprite = spr_icetruck_facedown;
original_sprite = sprite_index;

// Set direction and sprites
face = DOWN;
sprite[RIGHT] = spr_player_right;
sprite[UP] = spr_player_up;
sprite[LEFT] = spr_player_left;
sprite[DOWN] = spr_player_down;
sprite[UP_RIGHT] = spr_player_up_right;
sprite[UP_LEFT] = spr_player_up_left;
sprite[DOWN_RIGHT] = spr_player_down_right;
sprite[DOWN_LEFT] = spr_player_down_left;

// Create Event of obj_player - Add these variables
interaction_cooldown = 0;
INTERACTION_COOLDOWN_TIME = 15; // Adjust as needed

// Step Event of obj_player - Replace existing E key checks with:
function handle_interaction() {
    if (interaction_cooldown > 0) {
        interaction_cooldown--;
        return;
    }
    
    if (keyboard_check_pressed(ord("E"))) {
        // Check for NPC interaction first
        var target_npc = instance_nearest(x, y, obj_npc);
        if (target_npc != noone && distance_to_object(target_npc) < 48) {
            target_npc.current_phrase = target_npc.phrases[irandom_range(0, array_length(target_npc.phrases) - 1)];
            target_npc.talk_timer = fps * 3;
            target_npc.interact_pause = fps * 3;
            interaction_cooldown = INTERACTION_COOLDOWN_TIME;
            return;
        }
        
        // Then check for vehicle interactions
        if (distance_to_object(obj_icetruck) < 32) {
            obj_controller.switch_skin(global.current_skin == "player" ? "icetruck" : "player");
            interaction_cooldown = INTERACTION_COOLDOWN_TIME;
            return;
        }
        
        if (distance_to_object(obj_tube) < 32) {
            obj_controller.switch_skin(global.current_skin == "player" ? "tube" : "player");
            interaction_cooldown = INTERACTION_COOLDOWN_TIME;
            return;
        }
    }
}

// Add to player Step Event:
handle_interaction();

// Debugging
show_debug_message("obj_player: Initialized. Driving state: " + string(driving));